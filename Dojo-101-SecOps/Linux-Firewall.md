# Firewall Linux

## iptables

### contenu du fichier Firewall.cfg

```shell
# Generated by iptables-save v1.6.2 on Tue Oct  2 07:58:07 2018
*nat
:PREROUTING ACCEPT [0:0]
:INPUT ACCEPT [0:0]
:OUTPUT ACCEPT [1:76]
:POSTROUTING ACCEPT [1:76]
COMMIT
# Completed on Tue Oct  2 07:58:07 2018
# Generated by iptables-save v1.6.2 on Tue Oct  2 07:58:07 2018
*filter
:INPUT DROP [0:0]
:FORWARD DROP [0:0]
:OUTPUT ACCEPT [1:76]
-A INPUT -i lo -j ACCEPT
-A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT
-A INPUT -p tcp -m tcp --dport 80 --tcp-flags SYN SYN -m state --state NEW -j ACCEPT
-A INPUT -p tcp -m tcp --dport 443 --tcp-flags SYN SYN -m state --state NEW -j ACCEPT
-A OUTPUT -o lo -j ACCEPT
COMMIT
# Completed on Tue Oct  2 07:58:07 2018
```

### contenu du fichier Firewall6.cfg

```shell
# Generated by xtables-save v1.8.2 on Sat Mar 30 19:49:18 2019
*filter
:INPUT DROP [0:0]
:FORWARD DROP [0:0]
:OUTPUT DROP [0:0]
-A INPUT -i lo -j ACCEPT
-A OUTPUT -o lo -j ACCEPT
COMMIT
# Completed on Sat Mar 30 19:49:18 2019
# Generated by xtables-save v1.8.2 on Sat Mar 30 19:49:18 2019
*nat
:PREROUTING ACCEPT [0:0]
:INPUT ACCEPT [0:0]
:POSTROUTING ACCEPT [0:0]
:OUTPUT ACCEPT [0:0]
COMMIT
# Completed on Sat Mar 30 19:49:18 2019
```

### pour ajouter la config au démarrage

```shell
Ajouter "pre-up iptables-restore < /home/michael/Documents/Firewall.cfg" a la fin du fichier /etc/network/interfaces
Ajouter "pre-up iptables-restore < /home/michael/Documents/Firewall6.cfg" a la fin du fichier /etc/network/interfaces
```

----

## UFW

### Comandes pour configurer simplement un firewall avec UFW sous Linux

* On veut fermer tout le traffic entrant et autoriser le traffic sortant
* On veut aussi autoriser les protocoles ssh (port 22 en tcp), http/https (ports 80/443 en tcp), dns (port 53 en udp) et dhcp (port 68 en udp)

commande de démarrage de ufw

```sh
ufw enable
```

### autorisation d'IPV6 si nécessaire

```sh
nano /etc/default/ufw
# vérifier qu'il y a la ligne IPV6=yes
```

### auotrisations des entrées et sorties

```sh
ufw default deny incoming
ufw default allow outgoing
```

### configuration des protocoles

```sh
ufw allow 22/tcp
ufw allow 80/tcp
ufw allow 443/tcp
ufw allow 53/udp
ufw allow 68/udp
```

----

## Firewalld

contribution d'Antoine BARLOT & Imad

```shell
systemctl enable firewalld
systemctl start firewalld
```

lister la conf

```shell
firewall-cmd --state
firewalld-cmd --get-default-zone
firewall-cmd --get-active-zones
firewall-cmd --zone=public --list-services
```

changer d'interface

```shell
firewall-cmd --zone=<zone-name> --change-interface=<interface-name>
```

lister les services

```shell
firewall-cmd --zone=public --list-services
```

Pour activer le service SSH

```shell
firewall-cmd --zone=public --add-service=ssh --permanent
```

Désactiver tous les services inutiles

```shell
firewall-cmd --zone=public --remove-service=XXXX --permanent
```

fermer les ports inutiles

```shell
firewall-cmd --remove-port= port-number/port-type
```

Ajout d'un service

```shell
#cp /usr/lib/firewalld/services/http.xml /etc/firewalld/services/http2.xml #exemple pour avoir un nouveau service à ajouter
firewall-cmd --zone=public --add-service=http2
firewall-cmd --zone=public --add-service=http2 --permanent
```

Supprimer un service

```shell
firewall-cmd --zone=public --remove-service=(service)
```

> [!IMPORTANT]
penser reload Firewalld

```shell
firewall-cmd --reload
```
