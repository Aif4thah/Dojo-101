# Setup Android Bug Bounty

[@Contribution from ZZ0R0](https://github.com/ZZ0R0)

1. Setup AVD
2. Root AVD
3. Setup ADB
4. Setup Burp
5. A vos marques, prêts, Hackez ! 

Disclamer => Pour seulement configurer le proxy burp, skip l'étape 2

## Pré-requis

1. [**Android Studio**](https://developer.android.com/studio?hl=fr)
2. [**ADB**](https://www.xda-developers.com/install-adb-windows-macos-linux/)
3. [**rootAVD**](https://github.com/newbit1/rootAVD)
4. [**Termux APK**](https://f-droid.org/fr/packages/com.termux/)
5. [**Burp SUite**](https://portswigger.net/burp/communitydownload)

### 1. Créer et Lancer un AVD

1. Ouvrez Android Studio.
2. Allez dans **Tools > Device Manager**.
3. Cliquez sur **Create Virtual Device**.
4. Sélectionnez un profil avec play store activé (Ex Tablet Medium ou Pixel 7A Pro)
5. Cliquez sur **Next** et choisissez dans images x86 **Q (API 29, x86_64)**.
6. Cliquez sur **Next**, puis sur **Finish** pour créer l'AVD.
7. Lancez l'AVD en cliquant sur l'icône de lecture à côté de l'AVD.

### 2. Configurer rootAVD

0. S'assurer que la machine AVD est démarée 
1. Lancer .\rootAVD.bat ou ./rootAVD.sh suivant l'OS
2. Lancer la commande suivante (Ici Linux, adapter pour windows)
```
./rootAVD.sh system-images/android-29/google_apis_playstore/x86_64/ramdisk.img
```
3. Appuyer sur [Enter] quand l'installation prompt
4. Si l'AVD ne s'éteint pas toute seul, l'éteindre
5. Lancer l'AVD
6. Lancer Magisk, quand Magisk prompt de faire le setup cliquer sur ok
7. Relancer l'AVD
8. Dans Magisk, aller dans les paramètres, activer Zygisk et Enforce Deny list
9. Redémarrer l'AVD
9. Pour éviter qu'une application detecte le root, l'ajouter dans la Deny List de magisk et redémarrer (ne fonctionne pas avec les apps qui font des appels a playstore pour connaitre l'état du root)


### 3. Configurer ADB

``` 
adb devices 
``` 

ex => 

``` 
elz🌐Vx00(~)=>adb devices               
List of devices attached
emulator-<emulator_id>	device
``` 

``` 
adb -s emulator-<emulator_id> shell
su
exit
```

=> on est bien root

### 4. Proxy Burp

1. Configurer le proxy => Burp => Settings => Proxy => Proxy Listeners => Add => port 8081 All interfaces
2. Exporter le certificat => Burp => Settings => Proxy => Import/Export cert => Cert in DER => => burp_cert.cer
3. Importer le certificat => AVD => 
```
adb -s emulator-<emulator_id> push /local/host/path/burp_cert.crt /sdcard/Download/
```
4. Trust le cert burp dans AVD => AVD => Downloads => Click on cert => name burp_cert => VPN and apps => valider
5. Activer le proxy sur la machine =>
```
adb -s emulator-<emulator_id> shell settings put global http_proxy <burp_ip>:8081
```
6. Désactiver le proxy =>
```
adb shell settings put global http_proxy :0 
```