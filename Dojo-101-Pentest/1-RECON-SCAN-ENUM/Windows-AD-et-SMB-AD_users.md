# AD users

## enumeration des utilisateurs:

nmap --script smb-enum-users.nse -p 445 <host>
sudo nmap -sU -sS --script smb-enum-users.nse -p U:137,T:139 <host>

## ridenum (apt install)
### Connect to the remote server (192.168.1.236) and cycle from RID 500 to 50000 (500 50000), using the given password file (/tmp/passes.txt):

ridenum 192.168.1.236 500 50000 /tmp/passes.txt

## impacket
/usr/share/doc/python3-impacket/examples/lookupsid.py HTB/svc-alfresco:s3rvice@10.10.10.161

### sans authent:
/usr/share/doc/python3-impacket/examples/GetADUsers.py  -all -no-pass -dc-ip 10.10.10.172 MEGABANK.LOCAL/
Impacket v0.9.20 - Copyright 2019 SecureAuth Corporation

[*] Querying 10.10.10.172 for information about domain.
Name                  Email                           PasswordLastSet      LastLogon           
--------------------  ------------------------------  -------------------  -------------------
Guest                                                 <never>              <never>             
AAD_987d7f2f57d2                                      2020-01-02 23:53:24.984897  2020-01-13 20:26:39.751833 
mhope                                                 2020-01-03 00:40:05.908924  2020-01-03 14:29:59.037500 
SABatchJobs                                           2020-01-03 13:48:46.392235  2020-01-14 17:42:40.486176 
svc-ata                                               2020-01-03 13:58:31.332169  <never>             
svc-bexec                                             2020-01-03 13:59:55.863422  <never>             
svc-netapp                                            2020-01-03 14:01:42.786264  <never>             
dgalanos                                              2020-01-03 14:06:10.519660  <never>             
roleary                                               2020-01-03 14:08:05.832167  <never>             
smorgan                                               2020-01-03 14:09:21.629084  <never>             
michael@k:~/Documents/Projets/01HackTheBox/Monteverde$ 

### SPN
sur une machine locale:
setspn
setspn -Q */*


## Enum4linux
Enum4linux <IP>

# Kerberos:

## sur le rzo:
scanner les ports 88

## en local:
dsquery server

## kerbute
 ./kerbrute_linux_amd64 userenum -d HTB.local --dc 10.10.10.161 user 

    __             __               __     
   / /_____  _____/ /_  _______  __/ /____ 
  / //_/ _ \/ ___/ __ \/ ___/ / / / __/ _ \
 / ,< /  __/ /  / /_/ / /  / /_/ / /_/  __/
/_/|_|\___/_/  /_.___/_/   \__,_/\__/\___/                                        

Version: v1.0.2 (fd5f345) - 10/15/19 - Ronnie Flathers @ropnop

2019/10/15 17:31:39 >  Using KDC(s):
2019/10/15 17:31:39 >  	10.10.10.161:88

2019/10/15 17:31:39 >  [+] VALID USERNAME:	 Administrator@HTB.local
2019/10/15 17:31:39 >  [+] VALID USERNAME:	 andy@HTB.local
2019/10/15 17:31:39 >  [+] VALID USERNAME:	 lucinda@HTB.local
2019/10/15 17:31:39 >  [+] VALID USERNAME:	 mark@HTB.local
2019/10/15 17:31:39 >  [+] VALID USERNAME:	 santi@HTB.local
2019/10/15 17:31:39 >  [+] VALID USERNAME:	 sebastien@HTB.local
2019/10/15 17:31:39 >  [+] VALID USERNAME:	 svc-alfresco@HTB.local
2019/10/15 17:31:40 >  [+] VALID USERNAME:	 EXCH01$@HTB.local
2019/10/15 17:31:40 >  [+] VALID USERNAME:	 HealthMailbox0659cc1@HTB.local
2019/10/15 17:31:40 >  [+] VALID USERNAME:	 HealthMailbox6ded678@HTB.local
2019/10/15 17:31:40 >  [+] VALID USERNAME:	 HealthMailbox7108a4e@HTB.local
2019/10/15 17:31:40 >  [+] VALID USERNAME:	 HealthMailbox83d6781@HTB.local
2019/10/15 17:31:40 >  [+] VALID USERNAME:	 HealthMailbox968e74d@HTB.local
2019/10/15 17:31:40 >  [+] VALID USERNAME:	 HealthMailboxb01ac64@HTB.local
2019/10/15 17:31:40 >  [+] VALID USERNAME:	 HealthMailboxc0a90c9@HTB.local
2019/10/15 17:31:40 >  [+] VALID USERNAME:	 HealthMailboxc3d7722@HTB.local
2019/10/15 17:31:40 >  [+] VALID USERNAME:	 HealthMailboxfc9daad@HTB.local
2019/10/15 17:31:40 >  [+] VALID USERNAME:	 HealthMailboxfd87238@HTB.local
2019/10/15 17:31:40 >  Done! Tested 32 usernames (18 valid) in 0.461 seconds

cf chapitre "attacks" pour la suite




# ldap

sudo nmap -p 389 --script ldap-brute --script-args ldap.base='"cn=users,dc=megabank,dc=local"' 10.10.10.172

### une fois qu'on a un compte:

ldapdomaindump -u DANTE.LOCAL\\mrb3n -p Welcome1 172.16.1.20